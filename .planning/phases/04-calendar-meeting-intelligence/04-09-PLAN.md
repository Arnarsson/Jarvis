---
phase: 04-calendar-meeting-intelligence
plan: 09
type: execute
wave: 4
depends_on: [04-01, 04-02, 04-03, 04-04, 04-05, 04-06, 04-07, 04-08]
files_modified: []
autonomous: false
user_setup:
  - service: google_calendar
    why: "OAuth authentication requires user interaction"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "Anthropic Console -> API Keys"
    dashboard_config:
      - task: "Create OAuth credentials"
        location: "Google Cloud Console -> APIs & Services -> Credentials"
      - task: "Enable Calendar API"
        location: "Google Cloud Console -> APIs & Services -> Library"

must_haves:
  truths:
    - "Google Calendar OAuth flow completes successfully"
    - "Calendar events sync from Google Calendar"
    - "Meeting detection works when joining Zoom/Meet/Teams"
    - "Pre-meeting briefs are generated"
    - "MCP tools accessible from Claude Code"
  artifacts: []
  key_links: []
---

<objective>
End-to-end verification and integration testing of Phase 4

Purpose: Verify all Phase 4 components work together correctly. This includes Google Calendar OAuth setup, event syncing, meeting detection, and MCP tool access. User completes OAuth flow and verifies functionality.

Output: Verified Phase 4 functionality with successful end-to-end tests
</objective>

<execution_context>
@/home/sven/.claude/get-shit-done/workflows/execute-plan.md
@/home/sven/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-calendar-meeting-intelligence/04-RESEARCH.md
All previous 04-*-SUMMARY.md files
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify server starts with all Phase 4 components</name>
  <files></files>
  <action>
Start the server and verify all Phase 4 endpoints are available.

1. Start server:
   cd /home/sven/Documents/jarvis/server
   python -m jarvis_server.main

2. Check endpoints are registered:
   curl http://localhost:8000/docs | grep -E "(calendar|meetings)"

3. Verify calendar models are created:
   Check database has calendar_events, meetings, sync_states tables

4. Verify ARQ worker has new tasks:
   Check processing/tasks.py imports all tasks

Expected endpoints:
- GET /api/calendar/auth/status
- POST /api/calendar/auth/start
- POST /api/calendar/sync
- GET /api/calendar/events
- POST /api/meetings/start
- POST /api/meetings/end
- GET /api/meetings/current
- POST /api/meetings/brief/{event_id}
- GET /api/meetings/summary/{meeting_id}
- POST /api/meetings/audio/{meeting_id}
  </action>
  <verify>
curl -s http://localhost:8000/openapi.json | python -c "
import sys, json
spec = json.load(sys.stdin)
paths = list(spec.get('paths', {}).keys())
calendar_paths = [p for p in paths if 'calendar' in p]
meeting_paths = [p for p in paths if 'meeting' in p]
print(f'Calendar endpoints: {len(calendar_paths)}')
print(f'Meeting endpoints: {len(meeting_paths)}')
for p in calendar_paths + meeting_paths:
    print(f'  {p}')
"
  </verify>
  <done>Server running with all Phase 4 endpoints</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <what>Google Calendar OAuth Setup</what>
  <instructions>
The user needs to complete Google Calendar OAuth setup:

1. **Create Google Cloud Project (if not exists):**
   - Go to https://console.cloud.google.com/
   - Create new project or select existing
   - Enable Google Calendar API

2. **Create OAuth Credentials:**
   - Go to APIs & Services -> Credentials
   - Create OAuth 2.0 Client ID (Desktop App type)
   - Download credentials.json

3. **Place credentials file:**
   - Copy credentials.json to: /data/calendar/credentials.json
   - Or set JARVIS_DATA_DIR to point to your data directory

4. **Run OAuth flow:**
   - Call: POST http://localhost:8000/api/calendar/auth/start
   - Browser opens for Google sign-in
   - Authorize Jarvis to access calendar
   - Token saved automatically

5. **Verify authentication:**
   - Call: GET http://localhost:8000/api/calendar/auth/status
   - Should return: {"authenticated": true}
  </instructions>
  <resume-signal>Type "oauth complete" when Google Calendar is authenticated</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Test calendar sync</name>
  <files></files>
  <action>
Trigger calendar sync and verify events are imported.

1. Trigger sync:
   curl -X POST http://localhost:8000/api/calendar/sync

2. Check sync result:
   Should return {"status": "completed", "created": N, "updated": N, "deleted": N}

3. List synced events:
   curl http://localhost:8000/api/calendar/events?limit=5

4. Verify events have expected fields:
   - id, summary, start_time, end_time
   - attendees array
   - meeting_link (if video conference)
  </action>
  <verify>
curl -s http://localhost:8000/api/calendar/events?limit=3 | python -c "
import sys, json
events = json.load(sys.stdin)
print(f'Synced events: {len(events)}')
for e in events:
    print(f'  - {e.get(\"summary\", \"Untitled\")} at {e.get(\"start_time\", \"?\")}')
"
  </verify>
  <done>Calendar sync working, events imported</done>
</task>

<task type="auto">
  <name>Task 4: Test pre-meeting brief generation</name>
  <files></files>
  <action>
Generate a pre-meeting brief for an upcoming event.

1. Get upcoming events:
   curl http://localhost:8000/api/calendar/events?limit=1

2. Note the event ID

3. Generate brief:
   curl -X POST "http://localhost:8000/api/meetings/brief/{event_id}"

4. Verify brief contains:
   - Meeting context from memory search
   - Attendee information
   - Suggested preparation

Note: Brief quality depends on available memory context. If this is a new system,
the brief will acknowledge limited context.
  </action>
  <verify>
# Get first upcoming event and generate brief
EVENT_ID=$(curl -s http://localhost:8000/api/calendar/events?limit=1 | python -c "import sys, json; events = json.load(sys.stdin); print(events[0]['id'] if events else '')")
if [ -n "$EVENT_ID" ]; then
  curl -s -X POST "http://localhost:8000/api/meetings/brief/$EVENT_ID" | python -c "
import sys, json
data = json.load(sys.stdin)
print(f'Brief generated for: {data.get(\"event_summary\", \"Unknown\")}')
print(f'Brief length: {len(data.get(\"brief\", \"\"))} chars')
print('Brief preview:')
print(data.get('brief', '')[:300] + '...')
"
else
  echo "No upcoming events to test brief generation"
fi
  </verify>
  <done>Pre-meeting brief generation working</done>
</task>

<task type="auto">
  <name>Task 5: Verify MCP tools are available</name>
  <files></files>
  <action>
Test MCP server has all calendar and meeting tools.

1. Start MCP server in test mode:
   python -c "from jarvis_mcp.server import mcp; print([t.name for t in mcp.list_tools()])"

2. Verify tools include:
   - search_memory (from Phase 3)
   - get_upcoming_events
   - get_calendar_status
   - get_meeting_brief
   - get_meeting_summary
   - get_current_meeting

3. Update Claude Code config if needed:
   ~/.config/claude/claude_desktop_config.json should have jarvis-mcp server configured
  </action>
  <verify>
python -c "
from jarvis_mcp.server import mcp

tools = mcp.list_tools()
tool_names = [t.name for t in tools]
print(f'Total MCP tools: {len(tool_names)}')

expected = ['get_upcoming_events', 'get_calendar_status', 'get_meeting_brief', 'get_meeting_summary', 'get_current_meeting']
missing = [t for t in expected if t not in tool_names]
if missing:
    print(f'Missing tools: {missing}')
else:
    print('All Phase 4 MCP tools available')

for t in tools:
    if t.name in expected:
        print(f'  - {t.name}: {t.description[:60]}...')
"
  </verify>
  <done>All MCP tools available and ready</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Phase 4 Calendar & Meeting Intelligence</what-built>
  <how-to-verify>
1. **Test calendar in Claude Code:**
   - Open Claude Code
   - Ask: "What meetings do I have today?"
   - Claude should use get_upcoming_events tool and show your calendar

2. **Test pre-meeting brief in Claude Code:**
   - Ask: "Give me a brief for my next meeting"
   - Claude should use get_meeting_brief tool

3. **Test meeting detection (optional):**
   - Join a Zoom or Google Meet call
   - Check: curl http://localhost:8000/api/meetings/current
   - Should detect active meeting

4. **Verify all success criteria:**
   - [ ] Google Calendar syncs two-way
   - [ ] Pre-meeting briefs generated with context
   - [ ] Meeting detection identifies platforms
   - [ ] MCP tools work in Claude Code
  </how-to-verify>
  <resume-signal>Type "phase 4 verified" to complete, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Server starts with all Phase 4 endpoints
2. Google Calendar OAuth completes successfully
3. Calendar sync imports events
4. Pre-meeting briefs generate with context
5. MCP tools available in Claude Code
6. Meeting detection works (when in meeting)
</verification>

<success_criteria>
- Google Calendar syncs with two-way event access visible in Jarvis
- Pre-meeting briefs auto-generated with relevant context from memory
- Meeting detection identifies when user is in a meeting
- All MCP tools work correctly from Claude Code
- Phase 4 requirements CAL-01 through CAL-06 verified
</success_criteria>

<output>
After completion, create `.planning/phases/04-calendar-meeting-intelligence/04-09-SUMMARY.md`
</output>
