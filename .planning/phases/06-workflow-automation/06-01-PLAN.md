---
phase: 06-workflow-automation
plan: 01
type: execute
wave: 1
depends_on: []
autonomous: true
---

<objective>
Build foundation for pattern detection - database schema, models, and basic pattern storage.
</objective>

<context>
@server/src/jarvis_server/db/models.py
@.planning/REQUIREMENTS.md (AUTO-01)
</context>

<tasks>

<task type="auto">
<name>Task 1: Create workflow database models</name>
<files>server/src/jarvis_server/db/models.py</files>
<action>
Add SQLAlchemy models:
- Pattern: Detected repeated action sequences
  - id, name, description, pattern_type
  - trigger_conditions (JSON), actions (JSON)
  - frequency_count, last_seen
  - trust_tier (observe|suggest|auto)
  - created_at, updated_at
  
- PatternOccurrence: When pattern was detected
  - id, pattern_id, capture_id
  - context (JSON), confidence_score
  - detected_at
  
- WorkflowExecution: When automation ran
  - id, pattern_id, trigger_capture_id
  - status (pending|running|completed|failed|cancelled)
  - started_at, completed_at
  - result (JSON), error_message
  - user_approved (boolean), undo_available_until
</action>
<done>Models created</done>
</task>

<task type="auto">
<name>Task 2: Create Alembic migration</name>
<files>server/alembic/versions/xxx_add_workflow_tables.py</files>
<action>
Generate migration for new tables:
alembic revision --autogenerate -m "add workflow automation tables"
alembic upgrade head
</action>
<done>Migration applied</done>
</task>

<task type="auto">
<name>Task 3: Create pattern repository</name>
<files>server/src/jarvis_server/workflow/repository.py</files>
<action>
CRUD operations for patterns:
- create_pattern(name, pattern_type, trigger_conditions, actions)
- get_pattern(pattern_id)
- list_patterns(trust_tier=None, active_only=True)
- update_pattern(pattern_id, **kwargs)
- record_occurrence(pattern_id, capture_id, context, confidence)
- get_pattern_stats(pattern_id) -> frequency, last_seen, success_rate
</action>
<done>Repository created</done>
</task>

<task type="auto">
<name>Task 4: Create workflow module init</name>
<files>server/src/jarvis_server/workflow/__init__.py</files>
<action>
Initialize workflow module with exports.
</action>
<done>Module initialized</done>
</task>

</tasks>

<verification>
- Models import without errors
- Migration runs successfully
- Repository CRUD operations work
</verification>

<success_criteria>
- Pattern, PatternOccurrence, WorkflowExecution tables exist
- Repository can store and retrieve patterns
- Migration is reversible
</success_criteria>

<commit_guidance>
feat(06-01): add workflow automation database models and repository
</commit_guidance>
