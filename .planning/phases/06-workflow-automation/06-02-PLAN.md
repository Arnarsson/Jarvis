---
phase: 06-workflow-automation
plan: 02
type: execute
wave: 1
depends_on: [06-01]
autonomous: true
---

<objective>
Build pattern detector that identifies repeated action sequences from screen captures.
</objective>

<context>
@server/src/jarvis_server/search/hybrid.py
@server/src/jarvis_server/processing/worker.py
@.planning/REQUIREMENTS.md (AUTO-01)
</context>

<tasks>

<task type="auto">
<name>Task 1: Create pattern detector service</name>
<files>server/src/jarvis_server/workflow/detector.py</files>
<action>
PatternDetector class that analyzes captures:
- detect_patterns(capture_id) -> list[DetectedPattern]
- Uses OCR text + window title + app name
- Identifies repeated sequences:
  - Same app + similar text patterns
  - Time-based sequences (e.g., daily at 9am)
  - Trigger-response pairs (e.g., email from X -> open calendar)
  
Pattern types to detect:
- REPETITIVE_ACTION: Same action done frequently
- TIME_BASED: Action at specific times
- TRIGGER_RESPONSE: Action following another action
- WORKFLOW_SEQUENCE: Series of related actions
</action>
<done>Detector created</done>
</task>

<task type="auto">
<name>Task 2: Create sequence analyzer</name>
<files>server/src/jarvis_server/workflow/sequence.py</files>
<action>
SequenceAnalyzer for finding patterns in capture history:
- analyze_recent(hours=24) -> list[SequenceCandidate]
- find_similar_sequences(capture_id, min_similarity=0.8)
- extract_workflow_steps(sequence_ids) -> list[WorkflowStep]

Uses embeddings from Qdrant to find semantic similarity.
</action>
<done>Analyzer created</done>
</task>

<task type="auto">
<name>Task 3: Integrate with capture processing</name>
<files>server/src/jarvis_server/processing/worker.py</files>
<action>
After OCR processing completes:
- Call detector.detect_patterns(capture_id)
- Store detected patterns with low confidence initially
- Increment frequency_count for existing patterns
</action>
<done>Integration complete</done>
</task>

<task type="auto">
<name>Task 4: Add pattern detection config</name>
<files>server/src/jarvis_server/config.py</files>
<action>
Add workflow settings:
- workflow_detection_enabled: bool = True
- min_pattern_frequency: int = 3  # Before suggesting
- pattern_similarity_threshold: float = 0.85
- max_patterns_per_capture: int = 5
</action>
<done>Config added</done>
</task>

</tasks>

<verification>
- Detector identifies patterns from test captures
- Sequences are grouped correctly
- Integration doesn't slow down capture processing
</verification>

<success_criteria>
- Pattern detection runs on each capture
- Similar captures are grouped into patterns
- Frequency tracking works
</success_criteria>

<commit_guidance>
feat(06-02): add pattern detection for workflow automation
</commit_guidance>
