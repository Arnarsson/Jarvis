---
phase: 05-email-communication-context
plan: 06
type: execute
wave: 4
depends_on: [05-01, 05-02, 05-03, 05-04, 05-05]
autonomous: false
user_setup:
  - service: gmail
    why: "OAuth authentication requires user interaction"
---

<objective>
End-to-end verification of Phase 5 Email & Communication Context

This is a checkpoint plan requiring manual verification of email integration.
</objective>

<context>
@.planning/ROADMAP.md
@server/docker-compose.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify server starts with email components</name>
  <action>
docker compose build --no-cache
docker compose up -d
docker compose logs jarvis-server (verify no errors)
</action>
  <done>Server running with email modules</done>
</task>

<task type="checkpoint:human-action">
  <name>Task 2: Gmail OAuth Setup</name>
  <action>
1. Enable Gmail API in Google Cloud Console (same project as Calendar)
2. Copy credentials.json to /data/email/credentials.json
3. Run OAuth flow: POST http://localhost:8000/api/email/auth/start
4. Complete browser authentication
5. Verify: GET /api/email/auth/status returns {"authenticated": true}
</action>
  <resume_signal>Type "gmail connected" when OAuth complete</resume_signal>
</task>

<task type="checkpoint:human-verify">
  <name>Task 3: Verify email sync</name>
  <action>
Trigger sync: POST http://localhost:8000/api/email/sync
Verify:
- Sync returns message counts
- GET /api/email/messages shows synced emails
- Emails have subject, from, snippet
</action>
  <resume_signal>Type "approved" when email sync works</resume_signal>
</task>

<task type="checkpoint:human-verify">
  <name>Task 4: Verify email search</name>
  <action>
Wait for embedding processing, then:
POST /api/search/ with {"query": "project", "sources": ["email"]}
Verify:
- Returns email results
- source="email" in results
- Preview shows email info
</action>
  <resume_signal>Type "approved" when email search works</resume_signal>
</task>

<task type="checkpoint:human-verify">
  <name>Task 5: Verify MCP email tools in Claude Code</name>
  <action>
In Claude Code:
- Ask: "What's my email status?"
- Ask: "Search my emails about meetings"
- Ask: "Show me recent emails"
Verify tools work and return results.
</action>
  <resume_signal>Type "approved" when MCP tools work</resume_signal>
</task>

<task type="checkpoint:human-verify">
  <name>Task 6: Verify pre-meeting brief with email</name>
  <action>
Generate a brief for an upcoming meeting:
POST /api/meetings/brief/{event_id}?force_regenerate=true
Verify brief includes email context section.
</action>
  <resume_signal>Type "approved" when briefs include email</resume_signal>
</task>

<task type="auto">
  <name>Task 7: Update ROADMAP and mark Phase 5 complete</name>
  <action>Mark Phase 5 complete in ROADMAP.md</action>
  <done>Documentation updated</done>
</task>

</tasks>

<verification>
All manual verifications passed.
</verification>

<success_criteria>
- Gmail OAuth completes successfully
- Emails sync from Gmail to database
- Emails searchable via API with source="email"
- MCP email tools work in Claude Code
- Pre-meeting briefs include email context
</success_criteria>

<commit_guidance>
docs(05-06): complete Phase 5 email integration verification
</commit_guidance>
